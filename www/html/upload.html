<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>SERVER_NAME</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="/css/upload.css">
    <meta name="viewport" content="width=device-width,height=device-height,initial-scale=1">
    <script src="https://kit.fontawesome.com/cdcf7dd448.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css"
          integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5" crossorigin="anonymous">
    <script>
        let file = null

        function submitFile() {
            console.log("File:")
            console.log(file)

            if (file == null) {
                alert("You need to select a file first!")
                return
            }

            if (confirm("Selected file, would you like to upload it?")) {
                let formData = new FormData();
                formData.append("file", file);
                fetch('/api/upload', {method: "POST", body: formData})
                    .then(data => {
                        if (data.status === 201) {
                            alert("Successfully uploaded!")
                        } else {
                            alert("Error when uploading: " + data.status + " " + data.statusText)
                        }
                    })
            }
        }

        function loadFile(event) {
            const output = document.getElementById('output');
            output.src = URL.createObjectURL(event.target.files[0]);
            file = event.target.files[0]
            // Clear object from memory
            URL.revokeObjectURL(output.src)
        }
    </script>
</head>
<body>
<div class="pure-g">
    <div class="pure-u-1-3"></div>
    <div class="pure-u-1-3">
        <style scoped=""> /* for some reason this doesn't work outside the html */
        .round-button {
            border-radius: 5px;
            font-size: 120%;
        }

        .browse-button {
            border-radius: 5px;
        }
        </style>
        <div class="main-form">
            <input type="file" id="selected-file" accept="image/*" onchange="loadFile(event)"
                   class="browse-button pure-button pure-button-primary">
            <button type="submit" onclick="submitFile();" class="round-button pure-button pure-button-primary">
                <i class="fa fa-upload"></i> Upload
            </button>
        </div>
        <img class="output-img" id="output"/>
    </div>
    <div class="pure-u-1-3"></div>
</div>

</body>
</html>
